Mix Leap Study 特別編 - レガシーをぶっつぶせ。現場でDDD！ コラボカンファレンス
======================================================================

- 日時:2019/08/31(土) 13:00 〜 20:00 
- 場所: ヤフー株式会社 大阪グランフロントオフィス
    - 大阪府大阪市北区大深町4-20 グランフロント大阪 タワーA 37階
- [Mix Leap Study 特別編 \- レガシーをぶっつぶせ。現場でDDD！ コラボカンファレンス \- connpass](https://yahoo-osaka.connpass.com/event/138020/)


## レガシーをぶっつぶせ趣旨説明
[DXレポート ～ITシステム「2025年の崖」克服とDXの本格的な展開～（METI/経済産業省）](https://www.meti.go.jp/shingikai/mono_info_service/digital_transformation/20180907_report.html)


## ドメイン駆動設計という設計スタイル - 増田 亨 さん

### 設計スタイルの選択
設計スタイルの違い。入出力かドメインロジックの割合をどうとるか。

- 入出力に寄せるとトランザクションスクリプト (画面やデータに注目、入出力を手続き的に)
- ドメインロジックに寄せるとドメインオブジェクトモデル (値の種類に注目、独自の型を用意)

トランザクションスクリプトに慣れていると、ドメインオブジェクトモデルは手間が多く見える。

ビジネスルールに登場する値にまず注目、定義し計算と判断を持つ。
この部分がアプリケーションの8割方を占める(べき)。

### ドメインロジックに焦点を合わせる。
2つ必要。ドメイン知識(ビジネスルール)を学び続ける。知識をコードとして表現するのを改善していく。
この2つは相互に影響し合う関係。

ドメインという単語は単語の意味が広くてあいまい。以下のように言い換えている。
ドメインロジック -> ビジネスロジック (ビジネスルールを計算・判断するロジック)
ドメインの知識 -> ビジネスルール (ビジネス・人間の決めごと)

### ビジネスルール
ビジネスの活動の制約・促進するための決めごと。歴史的経緯など人の考え方などの影響を受け変わっていく。
人間が決めていることなので不整合だったりすることもある。

学び続けると、要求の意味を理解できる・関係性や構造が見えてくる

### ビジネスルールの基礎知識
#### ドメイン層の全体構造の設計指針
- 文書化されたビジネスルール (説明, 契約書, 業務マニュアル, 簿記予実管理)
- 顧客利益 vs 自社利益 の折り合いの付け方 (顧客と自社の価値とコスト)
- 競争戦略
- ビジネスルールの階層構造 (ポリシー、約束・契約、運用、)

### 独自の型を定義する
値オブジェクト (信頼性・追跡性)
条件判定を列挙型オブジェクトに持つ
ファーストクラスコレクション

独自の型を使うことの効果


## DDDのモデリングとは何なのか、そしてどうコードに落とすのか - 松岡 幸一郎 さん
[DDDのモデリングとは何なのか、 そしてどうコードに落とすのか](https://www.slideshare.net/koichiromatsuoka/domain-modeling-andcoding)

モデルとは -> 問題解決のために特定の側面を抽象化したもの

[20190831\-Mixleap\_現場でDDD\_松岡発表分参考資料\.md](https://gist.github.com/little-hands/58571e2f15f72244d5c82c0fc778144a)

ユースケースの具体化・言語か。見る人によって捉え方亜違ってくる。

ドメインモデル図、クラス図の簡易版。
集約を明記する。ドメイン知識(制約・ルール)を吹き出しで記述する、


## ドメイン駆動設計とマイクロサービス - 三石 広樹 さん

Yahoo プラットフォームシステムを、マイクロサービス + Twelve factor で開発してみたが、上手くはまらなかった

データモデルをもとにマイクロサービス化結果、実際にマイクロサービスとして独立できていなかった。
ビジネスとサービスの単位が不一致なのが原因ではないか。

### これまでの設計
1. データモデルを設計
2. データ設計をもとにWebAPIを設計


### ドメイン駆動設計
1. ドメインモデルを設計
2. 集約・コンテキストの境界を設計
3. 境界をもとにWebAPIにわける

### 実際にやってみた
関心事をモデリング。モデルを洗いだす。
関係を整理する。

フロントとWebAPIの間にBFF
WebAPIは Golang, BFFはTypeScript


改修範囲が広い -> ビジネスとサービスの単位一致により局所化
改修箇所の特定が難しい -> ビジネスロジックの

ドメイン駆動設計についての理解が得られにくい
複数チームは難しい
初期実装コストが高い。変更に強くするために初期にかかるコストは、とりあえず動くものを作るのと比べればかかる。

実装は後で変更できるが、サービスの分離・インターフェース・ビジネスロジックの変更は容易ではない。


## 抽象的な教えを試行錯誤しながら解釈した DDD の実践レポート - ほげ さん

単語の抽出、名刺を探す


## 過去の失敗例から再考するモデル駆動設計 - かとじゅん さん

### 軽量DDD に失敗してトランザクションスクリプトになってしまったt話
軽量DDDとは、DDDの戦略的な要素を使わず戦術的なことのみ使うつもりのもの。
開発だけでユビキタス言語 -> 開発者以外では別で言葉を使っていて結局言葉の翻訳が発生。
データがエンティティに、ロジックがサービスになってしまう。
ドメインロジックのつもりが、トランザクションスクリプトに。

アプリケーションサービスは進行役、ドメインロジックは持たない。
言語とモデルを作ってソフトウェアに反映する。
値オブジェクトを(まず)導入する。エンティティやリポジトリから考えると、入出力を意識してしまいがち。

ビジネスロジックの中の値には、動的な振る舞いがあるはず。それを表現するのが値オブジェクト。

コードを追いかけないと振る舞いが分からない
(実装者は記憶があるのでコードを追いかけないで済んでいるだけ。ただコードの制約として実装されていないので、何かの変更時に壊れているかも知れない)

CQRS、副作用や振る舞いだけを起こすためのものだけにフォーカス。

Event storming + Value Object でのモデリング。

PDCA (本来は、工場のほどまりを向上するための手法。プロジェクトを進めるのには向かない)
PDR (prep do review)